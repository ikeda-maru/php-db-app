# 商品管理アプリ

PHP−DB学習後の成果アプリ。
PHPを使用して、商品管理アプリを作成する。

CRUD(クラッド)
- Create
- Read
- Update
- Delete

ファイルの構成
- トップページ     - index.php
- 商品一覧ページ   - read.php
- 商品登録ページ   - create.php
- 商品編集ページ   - update.php
- 商品編集ページ   - update.php
- データの削除機能 - delete.php

## 商品一覧ページ
read.php

### データベースに接続し、商品一覧を表示
1. try-catch文と`PDO`クラスを使ってデータベース(`php_db_app`)に接続する
2. `query()`メソッドを使ってSELECT文を実行し、`products`テーブルからすべてのカラムのデータを取得する
3. `fetchAll()`メソッドを使ってSELECT文の実行結果を配列で取得する
4. foreach文を使って配列の中身を順番に出力する

### 並び替え機能の作成
1. `a`タグ(並び替えボタン)のhref属性に同じ`read.php`を指定し、末尾に`order`パラメータを付ける(値は`asc`または`desc`)
2. `if (isset($_GET['order'])) {~}`を記述し、`order`パラメータの値が存在すれば(並び替えボタンを押したとき)、その値を変数`$order`に代入する
3. `order`パラメータの値が存在しない場合は、変数`$order`に`NULL`を代入する
4. if文を使い、以下のように条件分岐させてORDER BY句を変更する
  1. 変数`$order`の値が`desc`のとき : 更新日時順(降順)で並び替える
  2. 変数`$order`の値がそれ以外のとき : 更新日時順(昇順)で並び替える

### 検索機能の作成
1. `input`タグの`name`属性に`keyword`を指定し、`keyword`パラメータとその値(入力内容)をフォームから送信できるようにする
2. `if (isset($_GET['keyword'])) {~}`を記述し`keyword`パラメータの値が存在すれば(「検索」ボタンを押したとき)その値を変数$keywordに代入する
3. `prepare()`メソッドを使い、LIKE句の値をプレースホルダ(`:keyword`)に置き換えたSELECT文をあらかじめ用意する
4. 変数`$keyword`の値を`%`で囲み(部分一致)、変数`$partial_match`に代入する(partial match=部分一致)
5. `bindValue()`メソッドを使い、変数`$partial_match`をプレースホルダ(`:keyword`)にバインドする(割り当てる)
6. SQL文を実行する

### 補足
- `form`要素内に`input`要素が1つしかない場合、送信ボタン(`type="submit"`)を作成しなくてもエンターキーを押せば入力内容を送信できる
- `order`パラメータと`keyword`パラメータの療法を同時に渡すことで、並び替え機能と検索機能を同時に使えるようになる
- `form`要素では`input type="hidden"`を使うことで、フォームの入力内容以外の隠しデータ(今回の場合は`order`パラメータとその値)も含めて送信できる
- 隠しデータとはいってもデベロッパーツールなどでソースコードを見ると丸見えなので、他人に知られてはいけないデータは絶対に`input type="hidden"`で送信してはならない

## 商品登録ページ
create.php
- `fetchAll()`メソッドの引数に`PDO::FETCH_COLUMN`を指定することで、1つのカラムの値を1次元配列(多次元ではない普通の配列)で取得できる

### データの追加機能の作成手順
1. `if (isset($_POST['submit'])) { ~ }`を記述し、`submit`パラメータの値が存在するとき(「登録」ボタンを押したとき)のみ処理を行う
2. try-catch文と`PDO`クラスを使ってデータベース(`php_db_app`)に接続する
3. `prepare()`メソッドや変数`$_POST`の値を使ってINSERT文を実行する
4. `header()`関数を使って商品一覧ページ(`read.php`)にリダイレクトさせる

### データの追加後に表示するメッセージの作成手順
1. `rowCount()`メソッドを使ってデータの追加件数を取得し、変数`$count`に代入する
2. 変数`$count`を埋め込んだメッセージ(`"商品を{$count}件登録しました。"`)を変数`$message`に代入する
3. `header()`関数で商品一覧ページにリダイレクトさせる際、URLの末尾に`message`パラメータをつけて値には変数`$message`を指定する(`read.php?message={$message}`)
4. 商品一覧ページ(`read.php`)「商品一覧」(`h1`要素)の下にPHPのコードを埋め込み、「`message`パラメータの値を受け取っていれば、それを表示する」という処理を追記する(`if (isset($_GET['message'])) { ~ }`)

- `rowCount()` :SQLのINSERT、UPDATE、DELETE文で追加、更新、削除した件数を取得する`PDOStatement`クラスのメソッド

## 商品編集ページ
update.php

### 商品編集ページの作成手順
1. `if (isset($_GET['id'])) { ~ }`を記述し、`id`パラメータの値が存在すれば処理を行う
2. try-catch文と`PDO`クラスを使ってデータベース(`php_db_app`)に接続する
3. `prepare()`メソッドを使い、WHERE句の`id`の値をプレースホルダ(`:id`)に置き換えたSELECT文をあらかじめ用意する
4. `bindValue()`メソッドを使い、受け取った商品の`id`(`$_GET['id']`)をプレースホルダ(`:id`)にバインドする(割り当てる)
5. SQL文を実行する
6. SQL文の実行結果を`fetch()`メソッドで取得する
7. 実行結果を取得できなかった場合(`id`パラメータの値と同じ`id`のデータが存在しない場合)は、メッセージを表示して処理を終了する
8. 取得した実行結果を各フォームの`value`属性に埋め込み、PHPのecho文(省略形)で出力する
9. `form`タグの`action`属性に`"update.php?id=<?= $_GET['id'] ?>"`を指定し、「更新」ボタンを押したときにも`id`を渡せるようにしておく

### データの更新機能の作成手順
1. `if (isset($_POST['submit'])) { ~ }`を記述し、`submit`パラメータの値が存在するとき(「更新」ボタンを押したとき)のみ処理を行う
2. try-catch文と`PDO`クラスを使ってデータベース(`php_db_app`)に接続する
3. `prepare()`メソッドや変数`$_POST`、変数`$_GET`の値を使ってUPDATE文を実行する
4. `rowCount()`メソッドを使ってデータの更新件数を取得し、変数`$count`に代入する
5. 変数`$count`を埋め込んだメッセージ(`"商品を{$count}件編集しました。"`)を変数`$message`に代入する
6. `header()`関数を使って`users.php`にリダイレクトさせる(`message`パラメータも渡す)

## 商品一覧ページに削除機能
delete.php

### データの削除機能の作成手順
1. try-catch文と`PDO`クラスを使ってデータベース(`php_db_app`)に接続する
2. `prepare()`メソッドを使い、WHERE句の`id`の値をプレースホルダ(`:id`)に置き換えたDELETE文をあらかじめ用意する
3. `bindValue()`メソッドを使い、受け取った商品の`id`(`$_GET['id']`)をプレースホルダ(`:id`)にバインドする(割り当てる)
4. SQL文を実行する
5. `rowCount()`メソッドを使ってデータの削除件数を取得し、変数`$count`に代入する
6. 変数`$count`を埋め込んだメッセージ(`"商品を{$count}件削除しました。"`)を変数`$message`に代入する
7. `header()`関数を使って`users.php`にリダイレクトさせる(`message`パラメータも渡す)